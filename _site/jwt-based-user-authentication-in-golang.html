<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>JWT-based User Authentication in Golang | nvkhuy</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="JWT-based User Authentication in Golang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="```go package main" />
<meta property="og:description" content="```go package main" />
<link rel="canonical" href="http://localhost:4000/jwt-based-user-authentication-in-golang" />
<meta property="og:url" content="http://localhost:4000/jwt-based-user-authentication-in-golang" />
<meta property="og:site_name" content="nvkhuy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-25T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JWT-based User Authentication in Golang" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-12-25T00:00:00+07:00","datePublished":"2023-12-25T00:00:00+07:00","description":"```go package main","headline":"JWT-based User Authentication in Golang","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jwt-based-user-authentication-in-golang"},"url":"http://localhost:4000/jwt-based-user-authentication-in-golang"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="nvkhuy" /><link type="image/png" sizes="48x48" rel="icon" href="/static/images/nvkh.png">

  <!-- highlight.js support -->
  <link rel="stylesheet" href="/js/highlightjs/styles/github.css">
  <link rel="stylesheet" href="/js/highlightjs/styles/ssms.css" />

  <script type="text/javascript" src="/js/highlightjs/highlight.min.js"></script>

  <script type="text/javascript" src="/js/highlightjs/languages/plaintext.min.js"></script>
  <script type="text/javascript" src="/js/highlightjs/languages/powershell.min.js"></script>
  <script type="text/javascript" src="/js/highlightjs/languages/tsql.min.js"></script>
  <script type="text/javascript" src="/js/highlightjs/languages/go.min.js"></script>

  <script type="text/javascript"> hljs.highlightAll(); </script>
  <!-- end highlight.js support -->
  
  
</head><body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">nvkhuy</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/archive.html">Archive</a><a class="page-link" href="/tags">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <link href="/css/override.css" rel="stylesheet" type="text/css">
<article class="post h-entry" itemscope itemtype="https://schema.org/BlogPosting">
    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">JWT-based User Authentication in Golang</h1>
        <div class="tags">
            Tags:
            
                <a href="/tags/jwt">jwt</a>
                
            
        </div>
        <p class="post-meta">
            <time class="dt-published" datetime="2023-12-25T00:00:00+07:00" itemprop="datePublished">Dec 25, 2023
            </time>
            </p>
    </header>

    <div class="share-links">
        <style>
  #share-buttons {display: inline-block; vertical-align: middle; }
  #share-buttons:after {content: ""; display: block; clear: both;}
  #share-buttons > div {position: relative; text-align: left; height: 36px; width: 32px; float: left; text-align: center;}
  #share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
  #share-buttons > div:hover {cursor: pointer;}
  #share-buttons > div.facebook:hover > svg {fill: #3B5998;}
  #share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
  #share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
  #share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
  #share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
  #share-buttons > div.instagram:hover > svg {fill: #C73B92;}
  #share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
  #share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
  #share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
  #share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
  #share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
  #share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>





<span style="color: silver;">Share on: </span><div id="share-buttons">
  <div class="facebook" title="Share this on Facebook"    onclick="window.open('http://www.facebook.com/share.php?u=http%3A%2F%2Flocalhost%3A4000%2Fjwt-based-user-authentication-in-golang','popup','width=600,height=600'); return false;">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
  <div class="twitter"  title="Share this on Twitter"     onclick="window.open('https://twitter.com/intent/tweet?url=http%3A%2F%2Flocalhost%3A4000%2Fjwt-based-user-authentication-in-golang&text=JWT-based+User+Authentication+in+Golang&via=nvkhuy','popup','width=600,height=600'); return false;">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
  <div class="linkedin" title="Share this on Linkedin"    onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Flocalhost%3A4000%2Fjwt-based-user-authentication-in-golang','popup','width=600,height=600'); return false;">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
  <div class="gplus"    title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fjwt-based-user-authentication-in-golang','popup','width=600,height=600'); return false;">
    <svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>
  <div class="mail"     title="Share this through Email"  onclick="window.open('mailto:?&body=http%3A%2F%2Flocalhost%3A4000%2Fjwt-based-user-authentication-in-golang&subject=%5BBlog%5D++-+JWT-based+User+Authentication+in+Golang','popup','width=600,height=600'); return false;">
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
    </div>

    <div class="post-content e-content" itemprop="articleBody">
        <pre><code class="language-go">package main

import (
	"fmt"
	"github.com/dgrijalva/jwt-go"
	"golang.org/x/crypto/bcrypt"
	"time"
)

// User struct represents a user in the system
type User struct {
	ID       int
	Username string
	Password string
}

var users = make(map[string]User) // Simulate a simple in-memory database

// Secret key for signing JWTs (should be kept secret)
var jwtSecret = []byte("your_jwt_secret")

// JWT claims structure
type Claims struct {
	UserID int `json:"user_id"`
	jwt.StandardClaims
}

func signup(username, password string) error {
	// Check if the username already exists
	if _, exists := users[username]; exists {
		return fmt.Errorf("username already exists")
	}

	// Hash the password before saving it
	hashedPassword, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
	if err != nil {
		return err
	}
	// Create a new user
	userID := len(users) + 1
	newUser := User{
		ID:       userID,
		Username: username,
		Password: string(hashedPassword),
	}

	// Save the user in the database
	users[username] = newUser
	return nil
}

func login(username, password string) (string, string, error) {
	// Retrieve the user from the database
	user, exists := users[username]
	if !exists {
		return "", "", fmt.Errorf("user not found")
	}

	// Compare the hashed password with the provided password
	err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(password))
	if err != nil {
		return "", "", fmt.Errorf("invalid password")
	}

	// Generate JWTs
	accessToken, err := generateAccessToken(user.ID)
	if err != nil {
		return "", "", err
	}

	refreshToken, err := generateRefreshToken(user.ID)
	if err != nil {
		return "", "", err
	}

	return accessToken, refreshToken, nil
}

func resetPassword(username, newPassword string) error {
	// Retrieve the user from the database
	user, exists := users[username]
	if !exists {
		return fmt.Errorf("user not found")
	}

	// Hash the new password before updating
	hashedPassword, err := bcrypt.GenerateFromPassword([]byte(newPassword), bcrypt.DefaultCost)
	if err != nil {
		return err
	}

	// Update the user's password
	user.Password = string(hashedPassword)
	users[username] = user

	return nil
}

func changePassword(userID int, currentPassword, newPassword string) error {
	// Retrieve the user from the database
	user, exists := getUserByID(userID)
	if !exists {
		return fmt.Errorf("user not found")
	}

	// Compare the current hashed password with the provided current password
	err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(currentPassword))
	if err != nil {
		return fmt.Errorf("invalid current password")
	}

	// Hash the new password before updating
	hashedPassword, err := bcrypt.GenerateFromPassword([]byte(newPassword), bcrypt.DefaultCost)
	if err != nil {
		return err
	}

	// Update the user's password
	user.Password = string(hashedPassword)
	users[user.Username] = user

	return nil
}

func getUserByID(userID int) (User, bool) {
	for _, user := range users {
		if user.ID == userID {
			return user, true
		}
	}
	return User{}, false
}

func generateAccessToken(userID int) (string, error) {
	// Create the JWT claims
	claims := Claims{
		UserID: userID,
		StandardClaims: jwt.StandardClaims{
			ExpiresAt: time.Now().Add(time.Hour * 1).Unix(), // Access token expires in 1 hour
			IssuedAt:  time.Now().Unix(),
		},
	}

	// Create the access token
	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
	accessToken, err := token.SignedString(jwtSecret)
	if err != nil {
		return "", err
	}

	return accessToken, nil
}

func generateRefreshToken(userID int) (string, error) {
	// Create the JWT claims
	claims := Claims{
		UserID: userID,
		StandardClaims: jwt.StandardClaims{
			ExpiresAt: time.Now().Add(time.Hour * 24 * 7).Unix(), // Refresh token expires in 7 days
			IssuedAt:  time.Now().Unix(),
		},
	}

	// Create the refresh token
	token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
	refreshToken, err := token.SignedString(jwtSecret)
	if err != nil {
		return "", err
	}

	return refreshToken, nil
}

func validateAccessToken(accessToken string) (int, error) {
	// Parse the token
	token, err := jwt.ParseWithClaims(accessToken, &amp;Claims{}, func(token *jwt.Token) (interface{}, error) {
		return jwtSecret, nil
	})

	if err != nil {
		return 0, err
	}

	// Verify the token
	claims, ok := token.Claims.(*Claims)
	if !ok || !token.Valid {
		return 0, fmt.Errorf("invalid access token")
	}

	return claims.UserID, nil
}

func refreshAccessToken(refreshToken string) (string, error) {
	// Parse the refresh token
	token, err := jwt.ParseWithClaims(refreshToken, &amp;Claims{}, func(token *jwt.Token) (interface{}, error) {
		return jwtSecret, nil
	})

	if err != nil {
		return "", err
	}

	// Verify the refresh token
	claims, ok := token.Claims.(*Claims)
	if !ok || !token.Valid {
		return "", fmt.Errorf("invalid refresh token")
	}

	// Generate a new access token
	newAccessToken, err := generateAccessToken(claims.UserID)
	if err != nil {
		return "", err
	}

	return newAccessToken, nil
}

func main() {
	// Sign up a new user
	err := signup("john_doe", "password123")
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	// Login and get tokens
	accessToken, refreshToken, err := login("john_doe", "password123")
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	// Simulate token validation (for demonstration purposes)
	userID, err := validateAccessToken(accessToken)
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	fmt.Printf("User ID: %d\n", userID)

	// Refresh access token
	newAccessToken, err := refreshAccessToken(refreshToken)
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	// Simulate token validation for the new access token (for demonstration purposes)
	userIDWithNewToken, err := validateAccessToken(newAccessToken)
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	fmt.Printf("User ID with new access token: %d\n", userIDWithNewToken)

	// Reset password
	err = resetPassword("john_doe", "newpassword456")
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	// Change password
	err = changePassword(userID, "newpassword456", "updatedpassword789")
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	// Validate access token again after changing password
	userIDAfterChange, err := validateAccessToken(accessToken)
	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	fmt.Printf("User ID after password change: %d\n", userIDAfterChange)
}

</code></pre>
<p>This Go code provides a simplified implementation of user authentication and authorization using JSON Web Tokens (JWT) in Golang. Let’s break down the code step by step:</p>

<p>User Struct and Database Setup:</p>
<pre><code class="language-go">type User struct {
	ID       int
	Username string
	Password string
}
</code></pre>

<p>Defines a User struct to represent a user in the system with attributes such as ID, username, and password.</p>
<pre><code class="language-go">var users = make(map[string]User)
</code></pre>

<p>Creates an in-memory map (users) to simulate a simple database where user data is stored.</p>
<pre><code class="language-go">var jwtSecret = []byte("your_jwt_secret")
</code></pre>

<p>Defines a secret key used for signing and verifying JWTs. In a real-world scenario, this should be kept secure and not hardcoded in the code.
JWT Claims Structure:</p>
<pre><code class="language-go">type Claims struct {
	UserID int `json:"user_id"`
	jwt.StandardClaims
}
</code></pre>

<p>Defines a Claims struct to represent the claims included in JWTs. In this case, it includes a UserID field and inherits from jwt.StandardClaims for standard JWT claims.
Signup Function:</p>
<pre><code class="language-go">func signup(username, password string) error {
    // ...
}
</code></pre>

<p>Implements user signup by checking if the username already exists, hashing the password, creating a new user, and saving it in the simulated database.
Login Function:</p>
<pre><code class="language-go">func login(username, password string) (string, string, error) {
    // ...
}
</code></pre>

<p>Handles user login by retrieving the user from the database, comparing the hashed password, and generating JWTs (access token and refresh token) if login is successful.
Reset Password Function:</p>
<pre><code class="language-go">func resetPassword(username, newPassword string) error {
    // ...
}
</code></pre>

<p>Allows users to reset their password by retrieving the user from the database and updating the hashed password.
Change Password Function:</p>

<pre><code class="language-go">func changePassword(userID int, currentPassword, newPassword string) error {
    // ...
}
</code></pre>

<p>Enables users to change their password by validating the current password, hashing the new password, and updating the user’s password in the database.
GetUserByID Function:</p>

<pre><code class="language-go">func getUserByID(userID int) (User, bool) {
    // ...
}
</code></pre>

<p>Retrieves a user from the database based on their ID.
Generate Access Token Function:</p>
<pre><code class="language-go">func generateAccessToken(userID int) (string, error) {
    // ...
}
</code></pre>

<p>Creates a new access token with user-specific claims and an expiration time.
Generate Refresh Token Function:</p>
<pre><code class="language-go">func generateRefreshToken(userID int) (string, error) {
    // ...
}
</code></pre>

<p>Generates a refresh token with user-specific claims and a longer expiration time.
Validate Access Token Function:</p>
<pre><code class="language-go">func validateAccessToken(accessToken string) (int, error) {
    // ...
}
</code></pre>

<p>Parses and validates an access token, returning the user ID if successful.
Refresh Access Token Function:</p>
<pre><code class="language-go">func refreshAccessToken(refreshToken string) (string, error) {
    // ...
}
</code></pre>

<p>Parses and validates a refresh token, then generates a new access token if successful.
Main Function:</p>
<pre><code class="language-go">func main() {
    // ...
}
</code></pre>

<p>Demonstrates the usage of the implemented functions, including user signup, login, password reset, password change, and access token refresh.
This code provides a foundation for implementing user authentication and authorization using JWTs in a Go application. It’s important to note that in a production environment, additional security measures, error handling, and database integration would be necessary. The secret key should be securely managed, and user passwords should be handled with care, potentially using more advanced hashing techniques.</p>

        <hr>
<div class="post_navi"><a class="post_navi-item nav_prev" href="/dependency-injection-vs-dependency-inversion" title="Dependency Injection vs Dependency Inversion">
    <div class="post_navi-arrow">&lt;</div><div class="post_navi-label">Previous Post</div><div><span>Dependency Injection vs Dependency Inversion</span></div>
  </a><a class="post_navi-item nav_next" href="/timeout-in-postgres" title="Timeout In Postgres">
    <div class="post_navi-arrow">&gt;</div><div class="post_navi-label">Next Post</div><div><span>Timeout In Postgres</span></div>
  </a></div>
    </div>

    <a class="u-url" href="/jwt-based-user-authentication-in-golang" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">nvkhuy</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">nvkhuy</li><li><a class="u-email" href="mailto:khanhhuynguyenvu@gmail.com">khanhhuynguyenvu@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/nvkhuy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">nvkhuy</span></a></li><li><a href="https://www.linkedin.com/in/nvkhuy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">nvkhuy</span></a></li><li><a href="https://www.twitter.com/nvkhuy"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">nvkhuy</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
